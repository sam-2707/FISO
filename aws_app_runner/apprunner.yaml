# AWS App Runner Deployment for FISO
# Modern serverless container platform - no Kubernetes needed!

# App Runner configuration
apiVersion: '1.0'
apprunner:
  service:
    name: fiso-app-runner
    source:
      imageRepository:
        imageIdentifier: 412374076384.dkr.ecr.us-east-1.amazonaws.com/fiso-api:latest
        imageConfiguration:
          port: 8080
          startCommand: "./fiso_server"
          runtimeEnvironmentVariables:
            - name: ENV
              value: production
            - name: POSTGRES_HOST
              value: fiso-postgres.cgli0siy6wfn.us-east-1.rds.amazonaws.com
            - name: POSTGRES_DB
              value: fiso_db
            - name: POSTGRES_USER
              value: fiso_user
    instanceConfiguration:
      cpu: 1 vCPU
      memory: 2 GB
    autoScalingConfiguration:
      minSize: 1
      maxSize: 10
      targetCpu: 70
      targetMemory: 80
    networking:
      ingressConfiguration:
        isPubliclyAccessible: true
      egressConfiguration:
        egressType: DEFAULT  # Allows access to RDS and external APIs

# Benefits of App Runner over EKS:
# ✅ Deploy in 5-10 minutes (vs 30+ minutes for EKS)
# ✅ $0.007/vCPU/hour + $0.0009/GB/hour (cheaper than EKS nodes)
# ✅ Automatic scaling (0 to thousands of containers)
# ✅ Built-in load balancer and SSL certificates
# ✅ Integrated with ECR, CloudWatch, VPC
# ✅ No node management, no CNI issues, no addon complexity
# ✅ Perfect for HTTP APIs and web services
