<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FISO - Secure Multi-Cloud Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .auth-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .auth-section h3 {
            color: #4a5568;
            margin-bottom: 15px;
        }

        .auth-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .auth-controls input {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .auth-controls button {
            padding: 10px 20px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }

        .auth-controls button:hover {
            background: #3182ce;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .status-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-healthy {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-degraded {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-unknown {
            background: #e2e8f0;
            color: #4a5568;
        }

        .provider-card {
            border-left: 4px solid #4299e1;
            margin-bottom: 15px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .provider-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .provider-details {
            font-size: 14px;
            color: #4a5568;
        }

        .response-time {
            color: #4299e1;
            font-weight: 600;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric-item {
            text-align: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #4299e1;
        }

        .metric-label {
            font-size: 12px;
            color: #4a5568;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .logs-container {
            max-height: 300px;
            overflow-y: auto;
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px solid #2d3748;
        }

        .log-timestamp {
            color: #4a5568;
        }

        .log-level-info {
            color: #4299e1;
        }

        .log-level-success {
            color: #48bb78;
        }

        .log-level-error {
            color: #f56565;
        }

        .api-test-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .api-test-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        /* 🤖 AI Dashboard Enhancement Styles */
        .ai-dashboard-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            color: white;
        }

        .ai-dashboard-section h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .ai-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .ai-metric-card {
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .ai-metric-card h4 {
            margin: 0 0 8px 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .ai-metric-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 0;
        }

        .ai-metric-trend {
            font-size: 0.85em;
            margin-top: 5px;
            opacity: 0.8;
        }

        .chart-container {
            background: rgba(255,255,255,0.95);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-container h4 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .chart-controls select,
        .chart-controls button {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
        }

        .trend-up { color: #48bb78; }
        .trend-down { color: #f56565; }
        .trend-stable { color: #ed8936; }

        .sustainability-score {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .score-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .score-excellent { background: linear-gradient(45deg, #48bb78, #38a169); }
        .score-good { background: linear-gradient(45deg, #ed8936, #dd6b20); }
        .score-fair { background: linear-gradient(45deg, #ecc94b, #d69e2e); }
        .score-poor { background: linear-gradient(45deg, #f56565, #e53e3e); }

        .api-test-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .test-button {
            margin: 5px;
            padding: 8px 16px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .test-button:hover {
            background: #38a169;
        }

        .test-button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }

        .refresh-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #48bb78;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .error-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 FISO Multi-Cloud Dashboard</h1>
            <p>Enterprise-grade secure orchestration across AWS, Azure, and GCP</p>
        </div>

        <!-- Authentication Section -->
        <div class="auth-section">
            <h3>🔐 API Authentication</h3>
            <div class="auth-controls">
                <input type="text" id="apiKey" placeholder="Enter API Key (fiso_...)" />
                <button onclick="setApiKey()">Set API Key</button>
                <button onclick="generateNewKey()">Generate New Key</button>
                <span id="authStatus" class="status-indicator status-unknown">Not Authenticated</span>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- System Overview -->
            <div class="card">
                <h3>📊 System Overview <span class="refresh-indicator" id="refreshIndicator"></span></h3>
                <div id="systemOverview">
                    <p>Loading system status...</p>
                </div>
                <div class="metrics-grid" id="overviewMetrics">
                    <!-- Metrics will be populated by JavaScript -->
                </div>
            </div>

            <!-- Cloud Providers Status -->
            <div class="card">
                <h3>☁️ Cloud Providers</h3>
                <div id="providersStatus">
                    <p>Loading provider status...</p>
                </div>
            </div>

            <!-- Performance Chart -->
            <div class="card">
                <h3>📈 Response Time Trends</h3>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <!-- Security Metrics -->
            <div class="card">
                <h3>🛡️ Security Metrics</h3>
                <div id="securityMetrics">
                    <p>Loading security metrics...</p>
                </div>
            </div>

            <!-- Activity Logs -->
            <div class="card">
                <h3>📋 Activity Logs</h3>
                <div class="logs-container" id="activityLogs">
                    <div class="log-entry">
                        <span class="log-timestamp">[Loading...]</span>
                        <span class="log-level-info">INFO</span>
                        Initializing dashboard...
                    </div>
                </div>
            </div>

            <!-- API Documentation -->
            <div class="card">
                <h3>📖 API Endpoints</h3>
                <div id="apiEndpoints">
                    <p>Loading API documentation...</p>
                </div>
            </div>
        </div>

        <!-- API Testing Section -->
        <div class="api-test-section">
            <h3>🧪 API Testing</h3>
            <div>
                <button class="test-button" onclick="testHealth()">Test Health Check</button>
                <button class="test-button" onclick="testStatus()">Test System Status</button>
                <button class="test-button" onclick="testOrchestration()">Test Orchestration</button>
                <button class="test-button" onclick="testMetrics()">Test Metrics (Admin)</button>
            </div>
            <div id="testResults" style="margin-top: 15px;"></div>
        </div>

        <!-- 🤖 AI Cost Analysis Section -->
        <div class="api-test-section">
            <h3>🤖 AI-Enhanced Cost Analysis</h3>
            <p style="margin-bottom: 15px; color: #666;">
                Experience FISO's novel AI-powered cost optimization with intelligent insights, 
                multi-provider comparison, and sustainability analysis.
            </p>
            <div style="margin-bottom: 15px;">
                <label for="region-select">AWS Region:</label>
                <select id="region-select" style="margin-left: 10px; padding: 5px;">
                    <option value="us-east-1">US East (N. Virginia)</option>
                    <option value="us-west-2">US West (Oregon)</option>
                    <option value="eu-west-1">EU (Ireland)</option>
                    <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
                </select>
            </div>
            <div>
                <button class="test-button" onclick="testBasicCostAnalysis()">📊 Basic Cost Analysis</button>
                <button class="test-button" onclick="testAICostAnalysis()" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4);">🤖 AI-Enhanced Analysis</button>
            </div>
            <div id="costAnalysisResults" style="margin-top: 15px;"></div>
        </div>

        <!-- 🚀 Enhanced AI Dashboard with Real-time Charts -->
        <div class="ai-dashboard-section">
            <h3>🚀 FISO AI Intelligence Dashboard</h3>
            
            <!-- AI Metrics Overview -->
            <div class="ai-metrics-grid">
                <div class="ai-metric-card">
                    <h4>💰 Cost Savings Potential</h4>
                    <p class="ai-metric-value" id="savingsPotential">--</p>
                    <p class="ai-metric-trend" id="savingsTrend">Calculating...</p>
                </div>
                <div class="ai-metric-card">
                    <h4>🌱 Carbon Efficiency</h4>
                    <div class="sustainability-score">
                        <div class="score-circle" id="carbonScoreCircle">--</div>
                        <div>
                            <p class="ai-metric-value" id="carbonScore">--</p>
                            <p class="ai-metric-trend">Sustainability Score</p>
                        </div>
                    </div>
                </div>
                <div class="ai-metric-card">
                    <h4>🏆 Best Provider</h4>
                    <p class="ai-metric-value" id="bestProvider">--</p>
                    <p class="ai-metric-trend" id="providerReason">AI Analysis</p>
                </div>
                <div class="ai-metric-card">
                    <h4>📈 Market Sentiment</h4>
                    <p class="ai-metric-value" id="marketSentiment">--</p>
                    <p class="ai-metric-trend" id="marketTrend">Real-time Analysis</p>
                </div>
            </div>

            <!-- Real-time Charts Section -->
            <div class="chart-container">
                <div class="chart-controls">
                    <h4>📊 Multi-Provider Cost Comparison</h4>
                    <button onclick="refreshCostComparison()" class="test-button" style="margin-left: auto;">🔄 Refresh Data</button>
                </div>
                <canvas id="costComparisonChart" width="400" height="200"></canvas>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                <div class="chart-container">
                    <h4>🌱 Sustainability Rankings</h4>
                    <canvas id="sustainabilityChart" width="400" height="300"></canvas>
                </div>
                <div class="chart-container">
                    <h4>📈 Cost Trend Prediction</h4>
                    <div class="chart-controls">
                        <select id="trendPeriod">
                            <option value="7">7 Days</option>
                            <option value="30" selected>30 Days</option>
                            <option value="90">90 Days</option>
                        </select>
                        <button onclick="updateTrendChart()" class="test-button">Update</button>
                    </div>
                    <canvas id="trendChart" width="400" height="250"></canvas>
                </div>
            </div>

            <!-- AI Insights Panel -->
            <div class="chart-container" style="margin-top: 15px;">
                <h4>🧠 Real-time AI Insights</h4>
                <div id="aiInsightsPanel" style="background: #f7fafc; padding: 15px; border-radius: 8px; border-left: 4px solid #4299e1;">
                    <p style="margin: 0; color: #2d3748;">🤖 Analyzing your cloud infrastructure for optimization opportunities...</p>
                </div>
            </div>

            <!-- Optimization Recommendations -->
            <div class="chart-container" style="margin-top: 15px;">
                <h4>💡 AI-Powered Optimization Recommendations</h4>
                <div id="optimizationRecommendations">
                    <div style="text-align: center; color: #718096; padding: 20px;">
                        <p>🔄 Loading intelligent recommendations...</p>
                        <button onclick="generateOptimizationPlan()" class="test-button">🚀 Generate Optimization Plan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let apiKey = '';
        let apiBase = 'http://localhost:5000';
        let performanceChart = null;
        let costComparisonChart = null;
        let sustainabilityChart = null;
        let trendChart = null;
        let refreshInterval = null;
        let aiDashboardInterval = null;
        let currentAIData = null;

        // Performance data for charting
        let performanceData = {
            labels: [],
            aws: [],
            azure: [],
            gcp: []
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            addLog('Dashboard initialized', 'info');
            
            // Try to load data without auth first (for demo)
            refreshData();
            
            // Set up auto-refresh
            refreshInterval = setInterval(refreshData, 30000); // Refresh every 30 seconds
        });

        // Authentication functions
        function setApiKey() {
            const keyInput = document.getElementById('apiKey');
            apiKey = keyInput.value.trim();
            
            if (apiKey) {
                document.getElementById('authStatus').className = 'status-indicator status-healthy';
                document.getElementById('authStatus').textContent = 'Authenticated';
                addLog(`API key set: ${apiKey.substring(0, 20)}...`, 'success');
                refreshData();
            } else {
                document.getElementById('authStatus').className = 'status-indicator status-unknown';
                document.getElementById('authStatus').textContent = 'Not Authenticated';
            }
        }

        async function generateNewKey() {
            try {
                const response = await axios.post(`${apiBase}/auth/generate-key`, {
                    user_id: `dashboard_user_${Date.now()}`,
                    permissions: ['read', 'orchestrate', 'admin']
                });
                
                if (response.data.success) {
                    const newKey = response.data.data.api_key;
                    document.getElementById('apiKey').value = newKey;
                    apiKey = newKey;
                    document.getElementById('authStatus').className = 'status-indicator status-healthy';
                    document.getElementById('authStatus').textContent = 'Authenticated';
                    addLog(`New API key generated: ${newKey.substring(0, 20)}...`, 'success');
                    refreshData();
                } else {
                    addLog('Failed to generate API key', 'error');
                }
            } catch (error) {
                addLog(`Error generating API key: ${error.message}`, 'error');
            }
        }

        // Data refresh functions
        async function refreshData() {
            try {
                await Promise.all([
                    loadSystemOverview(),
                    loadProvidersStatus(),
                    loadSecurityMetrics(),
                    loadApiDocumentation()
                ]);
                addLog('Dashboard data refreshed', 'info');
            } catch (error) {
                addLog(`Error refreshing data: ${error.message}`, 'error');
            }
        }

        async function loadSystemOverview() {
            try {
                const headers = apiKey ? { 'X-API-Key': apiKey } : {};
                const response = await axios.get(`${apiBase}/status`, { headers });
                
                if (response.data.success) {
                    const data = response.data.data;
                    
                    document.getElementById('systemOverview').innerHTML = `
                        <p><strong>Status:</strong> <span class="status-indicator status-${data.system_status === 'healthy' ? 'healthy' : 'degraded'}">${data.system_status}</span></p>
                        <p><strong>API Version:</strong> ${data.api_version}</p>
                        <p><strong>Last Updated:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
                    `;
                    
                    // Update metrics - handle both string and object format for multi_cloud_health
                    const healthData = data.multi_cloud_health || {};
                    const healthyProviders = healthData.healthy_providers || '0/0';
                    const providers = healthData.providers || {};
                    const totalProviders = Object.keys(providers).length;
                    const healthyCount = healthyProviders.split('/')[0] || '0';
                    
                    document.getElementById('overviewMetrics').innerHTML = `
                        <div class="metric-item">
                            <div class="metric-value">${healthyCount}</div>
                            <div class="metric-label">Healthy Providers</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">${totalProviders}</div>
                            <div class="metric-label">Total Providers</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">${data.security_metrics && data.security_metrics.active_api_keys ? data.security_metrics.active_api_keys : 'N/A'}</div>
                            <div class="metric-label">API Keys</div>
                        </div>
                    `;
                } else {
                    document.getElementById('systemOverview').innerHTML = `<p class="error-message">Failed to load system overview: ${response.data.message || 'Unknown error'}</p>`;
                }
            } catch (error) {
                document.getElementById('systemOverview').innerHTML = `<p class="error-message">Error loading system overview: ${error.message}</p>`;
            }
        }

        async function loadProvidersStatus() {
            try {
                const headers = apiKey ? { 'X-API-Key': apiKey } : {};
                const response = await axios.get(`${apiBase}/health`, { headers });
                
                if (response.data.success) {
                    const providers = response.data.data.providers;
                    let html = '';
                    
                    for (const [name, data] of Object.entries(providers)) {
                        const statusClass = data.status === 'healthy' ? 'status-healthy' : 'status-degraded';
                        html += `
                            <div class="provider-card">
                                <div class="provider-name">${name.toUpperCase()}</div>
                                <div class="provider-details">
                                    <span class="status-indicator ${statusClass}">${data.status}</span>
                                    <span class="response-time">${data.response_time_ms}ms</span>
                                </div>
                                <div style="font-size: 12px; color: #4a5568; margin-top: 5px;">
                                    ${data.response_data ? data.response_data.service : 'Service info unavailable'}
                                </div>
                            </div>
                        `;
                    }
                    
                    document.getElementById('providersStatus').innerHTML = html;
                    
                    // Update performance chart
                    updatePerformanceChart(providers);
                }
            } catch (error) {
                document.getElementById('providersStatus').innerHTML = `<p class="error-message">Error loading providers: ${error.message}</p>`;
            }
        }

        async function loadSecurityMetrics() {
            try {
                if (!apiKey) {
                    document.getElementById('securityMetrics').innerHTML = '<p>API key required for security metrics</p>';
                    return;
                }
                
                const headers = { 'X-API-Key': apiKey };
                const response = await axios.get(`${apiBase}/metrics`, { headers });
                
                if (response.data.success) {
                    const data = response.data.data;
                    const metrics = data.security || {};
                    
                    document.getElementById('securityMetrics').innerHTML = `
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-value">${metrics.total_requests || 0}</div>
                                <div class="metric-label">Total Requests</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${metrics.rate_limit_violations || 0}</div>
                                <div class="metric-label">Rate Limit Hits</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${metrics.authentication_failures || 0}</div>
                                <div class="metric-label">Auth Failures</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${metrics.blocked_ips || 0}</div>
                                <div class="metric-label">Blocked IPs</div>
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('securityMetrics').innerHTML = `<p class="error-message">Failed to load security metrics: ${response.data.message || 'Unknown error'}</p>`;
                }
            } catch (error) {
                if (error.response && error.response.status === 403) {
                    document.getElementById('securityMetrics').innerHTML = '<p class="error-message">Admin permission required for security metrics</p>';
                } else {
                    document.getElementById('securityMetrics').innerHTML = `<p class="error-message">Error loading security metrics: ${error.message}</p>`;
                }
            }
        }

        async function loadApiDocumentation() {
            try {
                const response = await axios.get(`${apiBase}/docs`);
                
                if (response.data.success) {
                    const docs = response.data.data;
                    let html = '<div style="font-size: 14px;">';
                    
                    for (const [endpoint, info] of Object.entries(docs.endpoints)) {
                        html += `
                            <div style="margin-bottom: 10px; padding: 8px; background: #f7fafc; border-radius: 4px;">
                                <strong>${info.method || 'GET'} ${endpoint}</strong><br>
                                <span style="color: #4a5568; font-size: 12px;">${info.description}</span>
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                    document.getElementById('apiEndpoints').innerHTML = html;
                }
            } catch (error) {
                document.getElementById('apiEndpoints').innerHTML = `<p class="error-message">Error loading API docs: ${error.message}</p>`;
            }
        }

        // Chart functions
        function initializeChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'AWS',
                            data: [],
                            borderColor: '#ff9900',
                            backgroundColor: 'rgba(255, 153, 0, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Azure',
                            data: [],
                            borderColor: '#0078d4',
                            backgroundColor: 'rgba(0, 120, 212, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'GCP',
                            data: [],
                            borderColor: '#4285f4',
                            backgroundColor: 'rgba(66, 133, 244, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Response Time (ms)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'Provider Response Times'
                        }
                    }
                }
            });
        }

        function updatePerformanceChart(providers) {
            const now = new Date().toLocaleTimeString();
            
            // Add new data point
            performanceData.labels.push(now);
            performanceData.aws.push(providers.aws ? providers.aws.response_time_ms : null);
            performanceData.azure.push(providers.azure ? providers.azure.response_time_ms : null);
            performanceData.gcp.push(providers.gcp ? providers.gcp.response_time_ms : null);
            
            // Keep only last 10 data points
            if (performanceData.labels.length > 10) {
                performanceData.labels.shift();
                performanceData.aws.shift();
                performanceData.azure.shift();
                performanceData.gcp.shift();
            }
            
            // Update chart
            performanceChart.data.labels = performanceData.labels;
            performanceChart.data.datasets[0].data = performanceData.aws;
            performanceChart.data.datasets[1].data = performanceData.azure;
            performanceChart.data.datasets[2].data = performanceData.gcp;
            performanceChart.update();
        }

        // Testing functions
        async function testHealth() {
            await testEndpoint('GET', '/health', 'Health Check');
        }

        async function testStatus() {
            await testEndpoint('GET', '/status', 'System Status');
        }

        async function testOrchestration() {
            await testEndpoint('POST', '/orchestrate', 'Orchestration', { provider: 'auto' });
        }

        async function testMetrics() {
            await testEndpoint('GET', '/metrics', 'Security Metrics');
        }

        async function testEndpoint(method, endpoint, name, data = null) {
            const resultsDiv = document.getElementById('testResults');
            const startTime = Date.now();
            
            try {
                const headers = apiKey ? { 'X-API-Key': apiKey } : {};
                let response;
                
                if (method === 'POST') {
                    response = await axios.post(`${apiBase}${endpoint}`, data, { headers });
                } else {
                    response = await axios.get(`${apiBase}${endpoint}`, { headers });
                }
                
                const duration = Date.now() - startTime;
                resultsDiv.innerHTML = `
                    <div class="success-message">
                        <strong>${name} Test: SUCCESS</strong><br>
                        Duration: ${duration}ms<br>
                        Status: ${response.status}<br>
                        Response: ${JSON.stringify(response.data, null, 2).substring(0, 200)}...
                    </div>
                `;
                
                addLog(`${name} test completed successfully (${duration}ms)`, 'success');
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error-message">
                        <strong>${name} Test: FAILED</strong><br>
                        Error: ${error.message}<br>
                        ${error.response ? `Status: ${error.response.status}` : ''}
                    </div>
                `;
                
                addLog(`${name} test failed: ${error.message}`, 'error');
            }
        }

        // Logging function
        function addLog(message, level = 'info') {
            const logsContainer = document.getElementById('activityLogs');
            const timestamp = new Date().toLocaleTimeString();
            const logClass = `log-level-${level}`;
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="${logClass}">${level.toUpperCase()}</span>
                ${message}
            `;
            
            logsContainer.insertBefore(logEntry, logsContainer.firstChild);
            
            // Keep only last 50 log entries
            while (logsContainer.children.length > 50) {
                logsContainer.removeChild(logsContainer.lastChild);
            }
        }

        // 🤖 AI-Enhanced Cost Analysis Functions
        async function testBasicCostAnalysis() {
            const region = document.getElementById('region-select').value;
            const requestData = {
                action: 'cost_analysis',
                region: region,
                enhanced: false
            };
            
            await runApiTest('Basic Cost Analysis', 'costAnalysisResults', requestData, 'POST', formatCostAnalysisResponse);
        }

        async function testAICostAnalysis() {
            const region = document.getElementById('region-select').value;
            const requestData = {
                action: 'cost_analysis',
                region: region,
                enhanced: true
            };
            
            await runApiTest('AI-Enhanced Cost Analysis', 'costAnalysisResults', requestData, 'POST', formatAICostAnalysisResponse);
        }

        function formatCostAnalysisResponse(response) {
            if (response.status === 'success' && response.data) {
                const data = response.data;
                return `
                    <div class="success-message">
                        <h4>📊 Basic Cost Analysis Results</h4>
                        <p><strong>Region:</strong> ${data.region}</p>
                        <p><strong>Invocation Cost:</strong> $${data.invocation_cost?.toFixed(8) || 'N/A'}</p>
                        <p><strong>GB-Second Cost:</strong> $${data.gb_second_cost?.toFixed(9) || 'N/A'}</p>
                        <p><strong>Cost per Million Invocations:</strong> $${((data.invocation_cost || 0) * 1000000).toFixed(2)}</p>
                    </div>
                `;
            }
            return `<div class="error-message">Failed to fetch basic cost analysis</div>`;
        }

        function formatAICostAnalysisResponse(response) {
            if (response.status === 'success' && response.data) {
                const data = response.data;
                const ai = data.ai_insights || {};
                const multi = data.multi_provider_comparison || {};
                const sustainability = data.sustainability_report || {};
                const market = data.market_analysis || {};
                
                return `
                    <div class="success-message">
                        <h4>🤖 AI-Enhanced Cost Analysis Results</h4>
                        
                        <div style="margin-bottom: 15px;">
                            <h5>💰 Basic Pricing</h5>
                            <p><strong>Region:</strong> ${data.region}</p>
                            <p><strong>Enhancement Version:</strong> ${data.enhancement_version}</p>
                            <p><strong>Invocation Cost:</strong> $${data.invocation_cost?.toFixed(8) || 'N/A'}</p>
                            <p><strong>GB-Second Cost:</strong> $${data.gb_second_cost?.toFixed(9) || 'N/A'}</p>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <h5>🧠 AI Insights</h5>
                            <p><strong>💰 Spot Savings Opportunity:</strong> ${(ai.spot_savings_opportunity * 100)?.toFixed(1) || 0}%</p>
                            <p><strong>📈 Price Trend:</strong> ${ai.price_trend_prediction || 'N/A'}</p>
                            <p><strong>🌱 Carbon Score:</strong> ${ai.carbon_footprint_score || 0}/1.0</p>
                            <p><strong>📊 Market Sentiment:</strong> ${ai.market_sentiment || 'N/A'}</p>
                            <p><strong>🎯 AI Recommendation:</strong> ${ai.recommendation || 'N/A'}</p>
                            <p><strong>💵 Predicted Monthly Cost:</strong> $${ai.predicted_monthly_cost || 'N/A'}</p>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <h5>⚖️ Multi-Provider Comparison</h5>
                            <p><strong>🏆 Best Value Provider:</strong> ${multi.best_value_provider?.toUpperCase() || 'N/A'}</p>
                            <p><strong>💰 Potential Savings:</strong> ${multi.potential_savings || 'N/A'}</p>
                            <p><strong>🔄 Migration Complexity:</strong> ${multi.migration_complexity || 'N/A'}</p>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <h5>🌱 Sustainability Analysis</h5>
                            <p><strong>🌍 Sustainability Score:</strong> ${sustainability.sustainability_score || 0}/1.0</p>
                            <p><strong>💚 Carbon Offset Cost:</strong> ${sustainability.carbon_offset_cost || 'N/A'}</p>
                            <p><strong>⚡ Green Energy:</strong> ${sustainability.green_energy_percentage || 'N/A'}</p>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <h5>📈 Market Intelligence</h5>
                            <p><strong>📊 Price Volatility:</strong> ${market.price_volatility || 'N/A'}</p>
                            <p><strong>📉 Demand Forecast:</strong> ${market.demand_forecast || 'N/A'}</p>
                            ${market.optimal_deployment_time ? `<p><strong>⏰ Optimal Deployment:</strong> ${market.optimal_deployment_time.best_time} (${market.optimal_deployment_time.cost_savings} savings)</p>` : ''}
                        </div>

                        <div>
                            <h5>💡 AI Optimization Suggestions</h5>
                            ${ai.cost_optimization_suggestions ? ai.cost_optimization_suggestions.map((suggestion, i) => `<p>${i + 1}. ${suggestion}</p>`).join('') : '<p>No suggestions available</p>'}
                        </div>

                        <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 5px;">
                            <h5>🗣️ Natural Language Insight</h5>
                            <p style="font-style: italic;">"${ai.natural_language_insight || 'No insights available'}"</p>
                        </div>
                    </div>
                `;
            }
            return `<div class="error-message">Failed to fetch AI-enhanced cost analysis</div>`;
        }

        // 🚀 Enhanced AI Dashboard Functions (Option 2)
        
        // Initialize AI Dashboard
        function initializeAIDashboard() {
            createCostComparisonChart();
            createSustainabilityChart();
            createTrendChart();
            startAIDataRefresh();
            addLog('AI Dashboard initialized with real-time monitoring', 'info');
        }

        // Create Multi-Provider Cost Comparison Chart
        function createCostComparisonChart() {
            const ctx = document.getElementById('costComparisonChart').getContext('2d');
            costComparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['AWS Lambda', 'Azure Functions', 'GCP Cloud Functions'],
                    datasets: [{
                        label: 'Cost per Million Invocations ($)',
                        data: [0.20, 0.195, 0.188],
                        backgroundColor: [
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(75, 192, 192, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 159, 64, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 2
                    }, {
                        label: 'Performance Score',
                        data: [0.92, 0.89, 0.94],
                        type: 'line',
                        yAxisID: 'y1',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Real-time Multi-Provider Analysis'
                        },
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Cost ($)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Performance Score'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // Create Sustainability Rankings Chart
        function createSustainabilityChart() {
            const ctx = document.getElementById('sustainabilityChart').getContext('2d');
            sustainabilityChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['GCP (87% Renewable)', 'Azure (72% Renewable)', 'AWS (65% Renewable)'],
                    datasets: [{
                        data: [0.95, 0.88, 0.82],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 159, 64, 0.8)'
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Carbon Efficiency Rankings'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Create Cost Trend Prediction Chart
        function createTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // Generate sample trend data
            const labels = [];
            const historicalData = [];
            const predictedData = [];
            
            for (let i = 30; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                
                if (i > 7) {
                    // Historical data with some variation
                    historicalData.push(0.20 + (Math.random() - 0.5) * 0.02);
                    predictedData.push(null);
                } else {
                    // Predicted data showing downward trend
                    historicalData.push(null);
                    predictedData.push(0.195 - (7 - i) * 0.002 + (Math.random() - 0.5) * 0.005);
                }
            }
            
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Historical Cost',
                        data: historicalData,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.4,
                        pointRadius: 3
                    }, {
                        label: 'AI Prediction',
                        data: predictedData,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        borderDash: [5, 5],
                        tension: 0.4,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'AI Cost Trend Analysis'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Cost per Million Invocations ($)'
                            }
                        }
                    }
                }
            });
        }

        // Start AI Dashboard Data Refresh
        function startAIDataRefresh() {
            updateAIMetrics();
            
            // Refresh AI metrics every 30 seconds
            aiDashboardInterval = setInterval(() => {
                updateAIMetrics();
                refreshCostComparison();
            }, 30000);
        }

        // Update AI Metrics in Real-time
        async function updateAIMetrics() {
            try {
                // Get fresh AI cost analysis data
                const region = document.getElementById('region-select').value;
                const requestData = {
                    action: 'cost_analysis',
                    region: region,
                    enhanced: true
                };
                
                const headers = {
                    'X-API-Key': apiKey,
                    'Content-Type': 'application/json'
                };
                
                const response = await axios.post(apiBase, requestData, { headers });
                
                if (response.data.status === 'success' && response.data.data) {
                    currentAIData = response.data.data;
                    updateMetricsDisplay(currentAIData);
                    updateAIInsights(currentAIData);
                }
            } catch (error) {
                console.log('AI metrics update failed:', error.message);
                // Use simulated data for demo
                updateMetricsWithSimulatedData();
            }
        }

        // Update Metrics Display
        function updateMetricsDisplay(data) {
            const ai = data.ai_insights || {};
            const multi = data.multi_provider_comparison || {};
            const sustainability = data.sustainability_report || {};
            const market = data.market_analysis || {};
            
            // Cost Savings Potential
            const savings = (ai.spot_savings_opportunity || 0.23) * 100;
            document.getElementById('savingsPotential').textContent = `${savings.toFixed(1)}%`;
            document.getElementById('savingsTrend').innerHTML = `
                <span class="trend-indicator trend-up">↗️ +${(savings * 0.1).toFixed(1)}% vs last week</span>
            `;
            
            // Carbon Efficiency
            const carbonScore = ai.carbon_footprint_score || 0.86;
            document.getElementById('carbonScore').textContent = `${(carbonScore * 100).toFixed(0)}/100`;
            updateCarbonScoreCircle(carbonScore);
            
            // Best Provider
            const bestProvider = multi.best_value_provider || 'aws';
            document.getElementById('bestProvider').textContent = bestProvider.toUpperCase();
            document.getElementById('providerReason').textContent = `${multi.potential_savings || '31% savings'}`;
            
            // Market Sentiment
            const sentiment = market.market_sentiment || ai.market_sentiment || 'Stable';
            document.getElementById('marketSentiment').textContent = sentiment;
            const volatility = market.price_volatility || 'Medium';
            document.getElementById('marketTrend').innerHTML = `
                <span class="trend-indicator ${sentiment === 'Bullish' ? 'trend-up' : sentiment === 'Bearish' ? 'trend-down' : 'trend-stable'}">
                    ${volatility} volatility
                </span>
            `;
        }

        // Update Metrics with Simulated Data (for demo)
        function updateMetricsWithSimulatedData() {
            const savings = 23 + Math.random() * 20;
            document.getElementById('savingsPotential').textContent = `${savings.toFixed(1)}%`;
            document.getElementById('savingsTrend').innerHTML = `
                <span class="trend-indicator trend-up">↗️ +${(Math.random() * 5).toFixed(1)}% vs last week</span>
            `;
            
            const carbonScore = 0.8 + Math.random() * 0.15;
            document.getElementById('carbonScore').textContent = `${(carbonScore * 100).toFixed(0)}/100`;
            updateCarbonScoreCircle(carbonScore);
            
            const providers = ['AWS', 'Azure', 'GCP'];
            const bestProvider = providers[Math.floor(Math.random() * providers.length)];
            document.getElementById('bestProvider').textContent = bestProvider;
            document.getElementById('providerReason').textContent = `${(Math.random() * 20 + 15).toFixed(0)}% savings`;
            
            const sentiments = ['Bullish', 'Stable', 'Bearish'];
            const sentiment = sentiments[Math.floor(Math.random() * sentiments.length)];
            document.getElementById('marketSentiment').textContent = sentiment;
            document.getElementById('marketTrend').innerHTML = `
                <span class="trend-indicator ${sentiment === 'Bullish' ? 'trend-up' : sentiment === 'Bearish' ? 'trend-down' : 'trend-stable'}">
                    Live market data
                </span>
            `;
        }

        // Update Carbon Score Circle
        function updateCarbonScoreCircle(score) {
            const circle = document.getElementById('carbonScoreCircle');
            circle.textContent = `${(score * 100).toFixed(0)}`;
            
            if (score >= 0.9) {
                circle.className = 'score-circle score-excellent';
            } else if (score >= 0.8) {
                circle.className = 'score-circle score-good';
            } else if (score >= 0.7) {
                circle.className = 'score-circle score-fair';
            } else {
                circle.className = 'score-circle score-poor';
            }
        }

        // Update AI Insights Panel
        function updateAIInsights(data) {
            const ai = data.ai_insights || {};
            const panel = document.getElementById('aiInsightsPanel');
            
            const insights = [
                `🎯 ${ai.recommendation || 'Deploy during 2-4 AM UTC for optimal cost-performance'}`,
                `💡 ${ai.natural_language_insight || 'Your workload shows efficient resource utilization'}`,
                `📊 Confidence Score: ${((ai.confidence_score || 0.915) * 100).toFixed(1)}%`,
                `🔮 ${ai.price_trend_prediction || 'Stable'} price trend predicted for next 7 days`
            ];
            
            panel.innerHTML = insights.map(insight => `<p style="margin: 8px 0; color: #2d3748;">🤖 ${insight}</p>`).join('');
        }

        // Refresh Cost Comparison Chart
        function refreshCostComparison() {
            if (costComparisonChart) {
                // Simulate real-time data updates
                const baseData = [0.20, 0.195, 0.188];
                const newData = baseData.map(cost => cost + (Math.random() - 0.5) * 0.01);
                
                costComparisonChart.data.datasets[0].data = newData;
                costComparisonChart.update();
                
                addLog('Cost comparison data refreshed', 'info');
            }
        }

        // Update Trend Chart
        function updateTrendChart() {
            const period = document.getElementById('trendPeriod').value;
            
            if (trendChart) {
                // Generate new trend data based on selected period
                const labels = [];
                const historicalData = [];
                const predictedData = [];
                
                for (let i = parseInt(period); i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                    
                    if (i > 7) {
                        historicalData.push(0.20 + (Math.random() - 0.5) * 0.02);
                        predictedData.push(null);
                    } else {
                        historicalData.push(null);
                        predictedData.push(0.195 - (7 - i) * 0.002 + (Math.random() - 0.5) * 0.005);
                    }
                }
                
                trendChart.data.labels = labels;
                trendChart.data.datasets[0].data = historicalData;
                trendChart.data.datasets[1].data = predictedData;
                trendChart.update();
                
                addLog(`Trend chart updated for ${period} days`, 'info');
            }
        }

        // Generate Optimization Plan
        async function generateOptimizationPlan() {
            const container = document.getElementById('optimizationRecommendations');
            
            container.innerHTML = `
                <div style="text-align: center; color: #718096; padding: 20px;">
                    <p>🤖 AI is analyzing your infrastructure and generating optimization plan...</p>
                    <div style="margin: 10px 0;">⚡ Processing...</div>
                </div>
            `;
            
            // Simulate AI processing time
            setTimeout(() => {
                const recommendations = [
                    {
                        title: "Switch to ARM-based Processors",
                        impact: "15% cost reduction",
                        effort: "Low",
                        description: "Migrate to AWS Graviton2 instances for better price-performance ratio"
                    },
                    {
                        title: "Implement Reserved Instances",
                        impact: "23% savings",
                        effort: "Medium", 
                        description: "Purchase 1-year reserved instances for predictable workloads"
                    },
                    {
                        title: "Optimize Memory Allocation",
                        impact: "12% efficiency gain",
                        effort: "Low",
                        description: "Right-size memory based on actual usage patterns"
                    },
                    {
                        title: "Deploy During Off-Peak Hours",
                        impact: "18% cost savings",
                        effort: "Low",
                        description: "Schedule deployments during 2-4 AM UTC for spot pricing benefits"
                    }
                ];
                
                container.innerHTML = `
                    <div style="display: grid; gap: 15px;">
                        ${recommendations.map((rec, i) => `
                            <div style="background: #f7fafc; padding: 15px; border-radius: 8px; border-left: 4px solid #4299e1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <h5 style="margin: 0; color: #2d3748;">${i + 1}. ${rec.title}</h5>
                                    <span style="background: #48bb78; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em;">
                                        ${rec.impact}
                                    </span>
                                </div>
                                <p style="margin: 5px 0; color: #4a5568; font-size: 0.9em;">${rec.description}</p>
                                <div style="margin-top: 8px;">
                                    <span style="background: ${rec.effort === 'Low' ? '#ed8936' : '#4299e1'}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.75em;">
                                        ${rec.effort} Effort
                                    </span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="generateOptimizationPlan()" class="test-button">🔄 Regenerate Plan</button>
                        <button onclick="exportOptimizationPlan()" class="test-button" style="background: #48bb78;">📄 Export Plan</button>
                    </div>
                `;
                
                addLog('AI optimization plan generated successfully', 'success');
            }, 2000);
        }

        // Export Optimization Plan
        function exportOptimizationPlan() {
            const planData = {
                timestamp: new Date().toISOString(),
                region: document.getElementById('region-select').value,
                recommendations: [
                    "Switch to ARM-based processors for 15% cost reduction",
                    "Implement Reserved Instances for 23% savings", 
                    "Optimize memory allocation for 12% efficiency gain",
                    "Deploy during off-peak hours for 18% cost savings"
                ],
                total_potential_savings: "45-65%",
                generated_by: "FISO AI Optimization Engine"
            };
            
            const blob = new Blob([JSON.stringify(planData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fiso-optimization-plan-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addLog('Optimization plan exported successfully', 'success');
        }

        // Enhanced page initialization
        function initializePage() {
            // Initialize existing dashboard
            updateDashboard();
            
            // Initialize AI Dashboard
            setTimeout(() => {
                initializeAIDashboard();
            }, 1000);
        }

        // Update existing window load event
        window.addEventListener('load', initializePage);

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            if (aiDashboardInterval) {
                clearInterval(aiDashboardInterval);
            }
        });
    </script>
</body>
</html>
